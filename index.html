<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket File Sync</title>
    <style>
        body {font-family: system-ui, sans-serif; text-align:center; padding:4rem; background:#0d1117; color:#58a6ff;}
        h1 {color:#79c0ff;}
        code {background:#161b22; padding:0.2em 0.4em; border-radius:6px;}
    </style>
</head>
<body>
<h1>WebSocket Sync Server</h1>
<p>Status: <strong id="status" style="color:#7ee787">RUNNING</strong></p>
<p>WebSocket endpoint: <code id="wss">ws://localhost:8080</code></p>
<p>Connected clients: <strong id="count">?</strong></p>
<p>To connect to this server, download <a target="_blank" href="client.js">client.js</a>.
    Then install dependencies and run it</p>
<pre>
    npm i ws https-proxy-agent
    node client.js
</pre>

<script>
  const id = "web"+Math.random().toString(36).substr(2, 9);
  const socketAddress = (location.protocol === "https:" ? "wss" : "ws") + '://' + location.host
  document.getElementById('wss').textContent = socketAddress;
  let ws = new WebSocket(socketAddress);
  ws.onopen = () => document.getElementById('status').textContent = 'connected';
  ws.onclose = () => document.getElementById('status').textContent = 'disconnected';
  ws.onmessage = event => {
    let msg;
    try { msg = JSON.parse(event.data); } catch { return; }
    if (msg.type === 'auth') {
      ws.send(JSON.stringify({ id }));
      return;
    }
    if (msg.type === 'discovery') {
      document.getElementById('count').textContent = msg.clients.length;
      return;
    }
  }
  let openSocket = (service, targetClientId, target, clientId, clientPort) => {
    ws.send(JSON.stringify({
      type: 'forward',
      service: "openPort",
      id: clientId,
      data: btoa(JSON.stringify({ id: targetClientId, port: clientPort, service, target}))
    }))
  }
</script>

</body>
</html>
